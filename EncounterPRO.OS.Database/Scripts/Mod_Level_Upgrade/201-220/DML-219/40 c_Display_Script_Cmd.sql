

-- Line comments within display script

update a
set long_value = 'Declare @cpr_id varchar(12)    Select @cpr_id = ''%cpr_id%''    SELECT distinct b.begin_date,   treatment_description,    c_Drug_Maker.maker_name,    lot_number,   convert(varchar(10),b.expiration_date,101) As Expiration,   cl.description As Location,   duration_prn As Lit_Date,  cu2.user_short_name AS Entered_by,    place_administered=COALESCE(c_Office.description, dbo.fn_patient_object_property(b.cpr_id, ''Treatment'', b.treatment_id, ''Place Administered'') )        INTO #temp_table         FROM p_treatment_item b WITH (NOLOCK)   LEFT OUTER JOIN p_treatment_progress pp WITH (NOLOCK)    ON  pp.cpr_id = b.cpr_id     AND pp.treatment_id = b.treatment_id    AND progress_type = ''CLOSED''   INNER JOIN     p_patient_encounter a WITH (NOLOCK)    ON a.encounter_id =  b.open_encounter_id     AND a.cpr_id = b.cpr_id    Left Outer JOIN c_location cl with (NOLOCK)    ON b.location = cl.location   LEFT OUTER JOIN c_Office with (NOLOCK) ON b.office_id = c_Office.office_id   LEFT OUTER JOIN c_Drug_Maker with (NOLOCK) ON b.maker_id = c_Drug_Maker.maker_id   Left Outer JOIN c_user cu2 with (NOLOCK)    ON pp.user_id = cu2.user_id  WHERE a.cpr_id = @cpr_id  and treatment_type = ''IMMUNIZATION''   and treatment_description is not null   and isnull(treatment_status,''Open'') = ''CLOSED''  order by treatment_description asc,b.begin_date asc    select   convert(varchar(10),begin_date,101) As ReportDate,  treatment_description,   maker_name,   lot_number,  Expiration,  location,  Lit_Date,  Entered_by As Entered,  Place_Administered    from #temp_table'
-- select long_value
from c_Display_Script_Cmd_attribute a 
where  display_script_id=1000973 
and display_command_id=1087013 
and attribute = 'query'
and charindex('--', long_value ) > 0


update a
set long_value = 'SELECT   u.user_full_name  ,o.description  ,p.description  ,us.access_flag  ,us.service    FROM c_user u   LEFT OUTER JOIN  c_user_role ur  ON u.user_id = ur.user_id  LEFT OUTER JOIN c_role r   ON ur.role_id = r.role_id  LEFT OUTER JOIN  c_user_role up   on u.user_id = up.user_id  LEFT OUTER JOIN c_privilege p  ON up.privilege_id = p.privilege_id  LEFT OUTER JOIN c_office o  ON up.office_id = o.office_id    LEFT OUTER JOIN   o_user_service us    ON ((u.user_id = us.user_id OR r.role_id = us.user_id) AND o.office_id = us.office_id)  LEFT OUTER JOIN o_service s    on us.service = s.service      ORDER by   u.user_full_name, o.description'
-- select long_value
from c_Display_Script_Cmd_attribute a 
where  display_script_id=581
and display_command_id=14093 
and attribute = 'query'
and charindex('--', long_value ) > 0

update a
set long_value = 'Declare @user_id varchar(24)  Declare @ls_cpr_id varchar(12)  Declare @li_encounter_id integer  Declare @billing_id varchar(24),@last_name varchar(40),@first_name varchar(20)  Declare @pat_name varchar(40)  Declare @encounterdate datetime  Declare @dischargedate datetime  Declare @mycount integer  Declare @mycount2 integer  Select @encounterdate = ''%encounter_date%''  Select @user_id = ''%user_id%''  Declare my_daily_curse Insensitive CURSOR for  SELECT pe.cpr_id,       pe.encounter_id,          p.billing_id,          p.last_name,          p.first_name,          pe.discharge_date   FROM p_Patient_Encounter pe (NOLOCK),   p_patient p (NOLOCK)   WHERE    bill_flag = ''Y''   AND encounter_status = ''CLOSED''  AND p.cpr_id = pe.cpr_id          AND (pe.attending_doctor = @user_id)          order by encounter_date    CREATE TABLE ##c_bill_Tree_Table (              [id] [int] IDENTITY (1, 1) NOT NULL ,              [encounter_date] datetime NULL,               [encounter_id] integer NULL,               [billing_id] [varchar] (24)  NULL ,              [pat_name] [varchar]   (40) NULL ,              [icd_9_code] [varchar] (12) NULL ,              [cpt_code] [varchar] (24) NULL ,              [modifier] [varchar] (2) NULL ,               [charge] [money]  NULL ,              [discharge_date] [datetime] NULL  ) ON [PRIMARY]    SELECT @mycount =  (Select count(*)         FROM p_Patient_Encounter (NOLOCK)         WHERE          bill_flag = ''Y''         AND encounter_status = ''CLOSED''         AND (attending_doctor = @user_id)         AND DATEDIFF(day, encounter_date, @encounterdate) = 0)  If @mycount > 0   BEGIN   Open my_daily_curse     WHILE @mycount > 0     BEGIN            FETCH NEXT FROM my_daily_curse         into @ls_cpr_id,@li_encounter_id,@billing_id,@last_name,@first_name,@dischargedate      Select @mycount = @mycount - 1       Select @pat_name = @last_name + '', '' + @first_name      SELECT @mycount2 =  (Select count(*)          FROM            p_Encounter_Assessment_Charge (NOLOCK),           p_Encounter_Assessment pea (NOLOCK),            p_Assessment (NOLOCK),           p_Encounter_Charge (NOLOCK),            c_Assessment_definition ca (NOLOCK),           p_Assessment_Treatment (NOLOCK),           c_procedure cp (NOLOCK)                 WHERE pea.cpr_id = @ls_cpr_id         AND pea.encounter_id = @li_encounter_id         AND p_Assessment.cpr_id = @ls_cpr_id         AND pea.problem_id = p_Assessment.problem_id         AND pea.assessment_billing_id is null         AND pea.bill_flag = ''Y''         AND p_Encounter_Assessment_Charge.cpr_id = pea.cpr_id         AND p_Encounter_Assessment_Charge.encounter_id = pea.encounter_id         AND p_Encounter_Assessment_Charge.problem_id = p_Assessment.problem_id         AND p_Encounter_Assessment_Charge.bill_flag = ''Y''         AND pea.cpr_id = p_Encounter_Charge.cpr_id         AND pea.encounter_id = p_Encounter_Charge.encounter_id         AND p_Encounter_Assessment_Charge.encounter_charge_id = p_Encounter_Charge.encounter_charge_id         AND p_Encounter_Charge.bill_flag = ''Y''          AND p_Assessment.assessment_id = ca.assessment_id         AND p_Assessment.cpr_id = p_Assessment_Treatment.cpr_id         AND p_Assessment.problem_id = p_Assessment_Treatment.problem_id         AND cp.procedure_id = p_Encounter_Charge.procedure_id               AND NOT EXISTS (SELECT *    FROM p_Assessment a2    WHERE a2.cpr_id = @ls_cpr_id    AND a2.problem_id = p_Assessment.problem_id    AND a2.diagnosis_sequence > p_Assessment.diagnosis_sequence))      If @mycount2 > 0         BEGIN        EXEC jmjrpt_get_bill_coding @ls_cpr_id, @li_encounter_id, @billing_id, @mycount2, @pat_name,@encounterdate,@dischargedate        END      END     Close my_daily_curse     END      Select distinct         billing_id As Billing_ID,         pat_name As Name,         icd_9_code AS ICD_9,         cpt_code AS CPT,         modifier AS Modifier,         charge AS Charge,         discharge_date AS Discharged  FROM ##c_bill_Tree_Table  group by encounter_date,billing_id,pat_name,icd_9_code,cpt_code,modifier,charge,discharge_date  order by pat_name    DROP Table ##c_bill_Tree_Table  DEALLOCATE my_daily_curse' -- select long_value
-- select long_value
from c_Display_Script_Cmd_attribute a 
where  display_script_id=1000585
and display_command_id=1063579 
and attribute = 'query'
and charindex('--', long_value ) > 0

update a
set long_value = 'Declare @begin_date varchar(10)  Declare @end_date varchar(10)  Select @begin_date = ''%begin_date%''  Select @end_date = ''%end_date%''  Declare @today DateTime  Select @today = GetDate()  Declare jmc_curse1 Insensitive cursor for  SELECT p_treatment_item.treatment_description,  p_treatment_item.drug_id,  pp.date_of_birth,  ca.authority_category  FROM p_treatment_item with (NOLOCK)  Inner Join  p_patient pp with (NOLOCK) ON  pp.cpr_id = p_treatment_item.cpr_id  AND (pp.date_of_birth is not NULL)  AND (DateDIFF(YEAR,pp.date_of_birth,@today) < 19)  Left Outer Join  p_patient_authority pa with (NOLOCK) ON  pa.cpr_id = p_treatment_item.cpr_id  Left Outer Join  c_authority ca with (NOLOCK) ON  ca.authority_id = pa.authority_id  WHERE (p_treatment_item.treatment_type IN (''PASTIMMUN'', ''IMMUNIZATION''))   AND (p_treatment_item.treatment_status = ''CLOSED'')   AND (p_treatment_item.treatment_description LIKE ''%(VFC)%'')   AND (p_treatment_item.end_date BETWEEN @begin_date AND DATEADD( day, 1, @end_date))   ORDER BY p_treatment_item.treatment_description,pp.date_of_birth desc     Declare @DOB datetime  Declare @Age integer  Declare @Age_months integer  Declare @the_result varchar(24)  Declare @mytype integer  Declare @mycount integer  Declare @vacc_descrip varchar(24),@drug_id varchar(24)  Declare @immune varchar(24)  Declare @class varchar(24)  SELECT @mycount =  (SELECT Count(p_treatment_item.treatment_description)  FROM p_treatment_item with (NOLOCK),  p_patient with (NOLOCK)  WHERE (p_treatment_item.treatment_type IN (''PASTIMMUN'', ''IMMUNIZATION''))   AND (Isnull(p_treatment_item.treatment_status,''Open'') = ''CLOSED'')   AND (p_treatment_item.treatment_description LIKE ''%(VFC)%'')   AND (p_treatment_item.end_date BETWEEN @begin_date AND DATEADD( day, 1, @end_date))   AND (p_treatment_item.cpr_id = p_patient.cpr_id)   AND (p_patient.date_of_birth is not NULL)   AND (DateDIFF(YEAR,p_patient.date_of_birth,@today) < 19)   )  If @mycount > 0   Begin   INSERT INTO #jmc_vfc   values(''DTAP'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''DT'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''Td'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''HIB'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''IPV'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''MMR'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''MEASLES'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''VARICELLA'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''PCV 7'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''HEPATITIS A'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''HEPATITIS B'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''INFLUENZA'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''PNEUMO'',NULL,NULL,NULL,NULL,NULL,NULL)   INSERT INTO #jmc_vfc   values(''COMVAX'',NULL,NULL,NULL,NULL,NULL,NULL)    INSERT INTO #jmc_vfc   values(''PEDIARIX'',NULL,NULL,NULL,NULL,NULL,NULL)                 Open jmc_curse1   WHILE @mycount > 0    BEGIN      FETCH NEXT FROM jmc_curse1       into @vacc_descrip,@drug_id,@DOB,@class      If @DOB IS NOT NULL    BEGIN      Select @Age_months = (DATEDIFF(month,@DOB,@today))      If DATEDIFF(day,@DOB,@today) > 0      BEGIN         Select @Age_months = @Age_months - 1      END      Select @Age =  @Age_months / 12    If @Age_months < 3      Begin         Select @mytype = 1      END       Else         If @Age > -1     Begin             SELECT @mytype =       CASE             WHEN (@Age < 1) THEN 2         WHEN (@Age IN (1,2,3,4,5,6)) THEN 3                WHEN ((@Age >= 7) AND (@Age <19)) THEN 4      ELSE 13      END      SELECT @immune =        CASE          WHEN (@drug_id = ''DTAP'') THEN @drug_id      WHEN (@drug_id = ''HEPA'') THEN ''HEPATITIS A''         WHEN (@drug_id = ''HEPB'') THEN ''HEPATITIS B''         WHEN (@drug_id = ''Hib'')  THEN ''HIB''         WHEN (@drug_id = ''OPV'')  THEN ''IPV''       WHEN (@drug_id = ''MMR'')  THEN ''MMR''         WHEN (@drug_id = ''Pnemococcus,Prevnar'') THEN ''PCV 7''      WHEN (@drug_id IN (''TETANUS'',''ZADULTTD'')) THEN ''Td''      WHEN (@drug_id = ''Varivax1'') THEN ''VARICELLA''         WHEN (@drug_id = ''PEDDT'') THEN ''DT''         WHEN (@drug_id = ''MEASLES'') THEN ''MEASLES''         WHEN (@drug_id = ''INFLUENZA'') THEN ''INFLUENZA''            WHEN (@drug_id = ''Pneumococcus'') THEN ''PNEUMO''      WHEN (@drug_id = ''comvax'') THEN ''COMVAX''      WHEN (@drug_id = ''Pediarix'') THEN ''PEDIARIX''       ELSE ''Other''       END              BEGIN    SELECT @the_result = asum FROM #jmc_vfc                    WHERE myvacc = @immune                       IF @the_result is null     BEGIN     SELECT @the_result = 1     END    ELSE              BEGIN      SELECT @the_result = @the_result + 1     END    UPDATE #jmc_vfc                   SET asum = @the_result                  WHERE myvacc = @immune      END                  If @mytype = 2    BEGIN    SELECT @the_result = la1 FROM #jmc_vfc WHERE myvacc = @immune    IF @the_result is null     BEGIN     SELECT @the_result = 1                END    ELSE                BEGIN      SELECT @the_result = @the_result + 1     END    UPDATE #jmc_vfc SET la1 = @the_result WHERE myvacc = @immune    END            ELSE     If @mytype = 3    BEGIN    SELECT @the_result = a1_6 FROM #jmc_vfc WHERE myvacc = @immune    IF @the_result is null     BEGIN     SELECT @the_result = 1     END    ELSE                BEGIN      SELECT @the_result = @the_result + 1     END    UPDATE #jmc_vfc SET a1_6 = @the_result WHERE myvacc = @immune                  END     ELSE     If @mytype = 4    BEGIN    SELECT @the_result = a7_18 FROM #jmc_vfc WHERE myvacc = @immune    IF @the_result is null     BEGIN     SELECT @the_result = 1     END    ELSE                BEGIN      SELECT @the_result = @the_result + 1     END    UPDATE #jmc_vfc SET a7_18 = @the_result WHERE myvacc = @immune                  END   END     END      Select @mycount = @mycount - 1   END   CLOSE jmc_curse1  END    SELECT myvacc AS VACCINE         ,isnull(la3mo,'''') AS less_3MO         ,isnull(la1,'''') AS less_1YR         ,isnull(a1_6,'''') AS Age_1_6         ,isnull(a7_18,'''') AS Age_7_18         ,isnull(asum,'''') AS Total    FROM #jmc_vfc    DEALLOCATE jmc_curse1    DROP TABLE #jmc_vfc'
-- select long_value
from c_Display_Script_Cmd_attribute a 
where  display_script_id=1000834	
and display_command_id=1066998 
and attribute = 'query'
and charindex('--', long_value ) > 0

delete from c_Display_Script_Cmd_attribute
where attribute = 'query'
and long_value not like '%select %'
and long_value not like '%exec %'
and long_value not like '%select' + char(13) + '%'


update [c_Component_Param]
set query = 'SELECT f.folder, f.folder  FROM c_Folder f  WHERE status = ''OK''  ORDER BY f.folder'
where param_sequence IN ( 1000617, 1000519 )
