<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta name="PROBLEM" content="Problem:  Error messages indicate database corruption" />
    <meta name="TITLE" content="Problem:  Error messages indicate database corruption" />
    <meta name="DESCRIPTION" content="" />
    <meta name="PROBLEM_TYPE" content="Problem Solution" />
    <meta name="AUDIENCE" content="sa" />
	<meta name="KEYWORDS" content="database corruption integrity checkdb reset database objects" />
    <link rel="stylesheet" type="text/css" href="images/common.css" />
    
    <title>Problem:  Error messages indicate database corruption</title>
</head>

<script type="text/javascript">function popup(image, width, height) { window.open(image, 'popup', 'width=' + width + ',height=' + height + ',scrollbars=yes'); }</script>

<body>
    <img src="images/logo.gif" border="0" alt="RightAnswers, Inc" /><br />
    <br />
    <hr />
    
    <!-- Begin Solution -->

	<div class="solutionPath"><b>Solution Path:</b> Supporting encounterPRO ver 5 &gt; Servers</div>
<hr />
<h2>Problem:  Error messages indicate database corruption</h2><table cellpadding="5" cellspacing="0" border="0" class="solutionTable">
<tr>
<td class="sectionLabel">
Cause:
</td>
<td class="sectionContent">
 <p> 
The most common cause of database corruption is an unexpected shutdown of the database server.  The second most common cause is a hardware failure, usually a hard drive or disk controller. </p>

</td>
</tr>
<tr>
<td class="sectionLabel">
Solution:
</td>
<td class="sectionContent">
<P class=MsoNormal style='MARGIN: 0in 0in 0pt'><SPAN style='COLOR: #1f497d'></SPAN> </p>
 
 <P class=MsoNormal style='MARGIN: 0in 0in 0pt'><SPAN style='COLOR: #1f497d'><FONT color=#000000>The first thing we want to do is inventory and secure all of the available database backups.  We may end up having to restore to one of them so we need to know what is available and to make sure that no backups get overwritten until this issue is resolved.</FONT></SPAN> </p>
 
 <P class=MsoNormal style='MARGIN: 0in 0in 0pt'><SPAN style='COLOR: #1f497d'></SPAN>  </p>
 
 <P class=MsoNormal style='MARGIN: 0in 0in 0pt'><SPAN style='COLOR: #1f497d'><?xml:namespace prefix = o ns = 'urn:schemas-microsoft-com:office:office' /><o:p><FONT face=Calibri color=#000000>Next we make an attempt to identify when the database corruption occurred.  The most common cause is hardware failure, so look in the system log for hardware errors.  An recent unexpected reboot or power outage or anything of that sort is highly likely to be the corruption event.</FONT></o:p></SPAN> </p>
 
 <P class=MsoNormal style='MARGIN: 0in 0in 0pt'><SPAN style='COLOR: #1f497d'><o:p><FONT face=Calibri color=#000000></FONT></o:p></SPAN>  </p>
 
 <P class=MsoNormal style='MARGIN: 0in 0in 0pt'><SPAN style='COLOR: #1f497d'><o:p><FONT face=Calibri color=#000000>If there is a backup from before the corruption with zero data loss for the customer, then restoring that backup is our first choice.</FONT></o:p></SPAN> </p>
 
 <P class=MsoNormal style='MARGIN: 0in 0in 0pt'><SPAN style='COLOR: #1f497d'><o:p></o:p></SPAN>  </p>
 
 <P class=MsoNormal style='MARGIN: 0in 0in 0pt'><SPAN style='COLOR: #1f497d'><o:p><FONT face=Calibri color=#000000>If all of the backups are either post-corruption or would lose data, then we should try to repair the corrupt database.</FONT></o:p></SPAN> </p>
 
 <P class=MsoNormal style='MARGIN: 0in 0in 0pt'><SPAN style='COLOR: #1f497d'><o:p><FONT face=Calibri color=#000000></FONT></o:p></SPAN>  </p>
 
<SPAN style='COLOR: #1f497d'><o:p> <P class=MsoNormal style='MARGIN: 0in 0in 0pt 0.5in; TEXT-INDENT: -0.25in; LINE-HEIGHT: normal'><SPAN style='FONT-SIZE: 12pt; COLOR: black; mso-fareast-font-family: Calibri; mso-bidi-font-family: Calibri; mso-ascii-font-family: Calibri; mso-hansi-font-family: Calibri; mso-themecolor: text1'><FONT face=Calibri>1)</FONT></SPAN><SPAN style='FONT-SIZE: 7pt; COLOR: black; FONT-FAMILY: ' Roman?,?serif?; mso-fareast-font-family: Calibri; mso-themecolor: text1? Times New>      </SPAN><FONT face=Calibri><SPAN style='FONT-SIZE: 12pt; COLOR: black; mso-fareast-font-family: ' Calibri; mso-themecolor: text1? Times New mso-bidi-font-family: ?Times mso-ascii-font-family: mso-hansi-font-family: Roman?;>Attempt to repair the database by rebuilding all indexes on corrupt tables</SPAN><SPAN style='FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: ' Roman?,?serif?; mso-fareast-font-family: mso-themecolor: text1? Times New ?Times Roman?;><o:p></o:p></SPAN></FONT> </p>
 
 <P class=MsoNormalCxSpMiddle style='MARGIN: 0in 0in 0pt 1.25in; TEXT-INDENT: -0.25in; LINE-HEIGHT: normal; mso-add-space: auto; tab-stops: list .5in'><SPAN style='FONT-SIZE: 10pt; COLOR: black; FONT-FAMILY: ' mso-fareast-font-family: mso-themecolor: text1? Arial?,?sans-serif?; Arial;>a)</SPAN><SPAN style='FONT-SIZE: 7pt; COLOR: black; FONT-FAMILY: ' Roman?,?serif?; mso-fareast-font-family: mso-themecolor: text1? Times New Arial;>     </SPAN><SPAN style='FONT-SIZE: 10pt; COLOR: black; FONT-FAMILY: ' mso-fareast-font-family: mso-themecolor: text1? New ?Times Roman?; Arial?,?sans-serif?;>Run 'DBCC CheckDB' in the cpr database<o:p></o:p></SPAN> </p>
 
 <P class=MsoNormalCxSpMiddle style='MARGIN: 0in 0in 0pt 1.25in; TEXT-INDENT: -0.25in; LINE-HEIGHT: normal; mso-add-space: auto; tab-stops: list .5in'><SPAN style='FONT-SIZE: 10pt; COLOR: black; FONT-FAMILY: ' mso-fareast-font-family: mso-themecolor: text1? Arial?,?sans-serif?; Arial;>b)</SPAN><SPAN style='FONT-SIZE: 7pt; COLOR: black; FONT-FAMILY: ' Roman?,?serif?; mso-fareast-font-family: mso-themecolor: text1? Times New Arial;>     </SPAN><SPAN style='FONT-SIZE: 10pt; COLOR: black; FONT-FAMILY: ' mso-fareast-font-family: mso-themecolor: text1? New ?Times Roman?; Arial?,?sans-serif?;>Search the output for all instances of the string 'msg'.<SPAN style='mso-spacerun: yes'>  </SPAN>These are error messages.</SPAN><SPAN style='FONT-SIZE: 12pt; COLOR: black; mso-fareast-font-family: ' Calibri; mso-themecolor: text1? Times New mso-bidi-font-family: ?Times mso-ascii-font-family: mso-hansi-font-family: Roman?;><o:p></o:p></SPAN> </p>
 
 <P class=MsoNormalCxSpMiddle style='MARGIN: 0in 0in 0pt 1.25in; TEXT-INDENT: -0.25in; LINE-HEIGHT: normal; mso-add-space: auto; tab-stops: list .5in'><SPAN style='FONT-SIZE: 10pt; COLOR: black; FONT-FAMILY: ' mso-fareast-font-family: mso-themecolor: text1? New ?Times Roman?; Arial?,?sans-serif?;>c)   For each table with error messages, run sp_rebuild_constraints</SPAN><SPAN style='FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: ' Roman?,?serif?; mso-fareast-font-family: mso-themecolor: text1? Times New ?Times Roman?;><o:p></o:p></SPAN> </p>
 
 <P class=MsoNormal style='MARGIN: 0in 0in 0pt 0.5in; TEXT-INDENT: -0.25in; LINE-HEIGHT: normal'><SPAN style='FONT-SIZE: 12pt; COLOR: black; mso-fareast-font-family: Calibri; mso-bidi-font-family: Calibri; mso-ascii-font-family: Calibri; mso-hansi-font-family: Calibri; mso-themecolor: text1'><FONT face=Calibri>2)</FONT></SPAN><SPAN style='FONT-SIZE: 7pt; COLOR: black; FONT-FAMILY: ' Roman?,?serif?; mso-fareast-font-family: Calibri; mso-themecolor: text1? Times New>      </SPAN><SPAN style='FONT-SIZE: 12pt; COLOR: black; mso-fareast-font-family: ' Calibri; mso-themecolor: text1? Times New mso-bidi-font-family: ?Times mso-ascii-font-family: mso-hansi-font-family: Roman?;><FONT face=Calibri>If that fails then put the database into single user mode and run CheckDB with flags instructing SQL to repair the damage.  Click <A href='http://http//msdn.microsoft.com/en-us/library/ms176064.aspx' target=_blank>here</A><A href='http://http://msdn.microsoft.com/en-us/library/ms176064.aspx'> </A>for instructions on running DBCC CHECKDB.</FONT></SPAN> </p>
 
 <P class=MsoNormal style='MARGIN: 0in 0in 0pt 0.5in; TEXT-INDENT: -0.25in; LINE-HEIGHT: normal'><SPAN style='FONT-SIZE: 12pt; COLOR: black; mso-fareast-font-family: Calibri; mso-bidi-font-family: Calibri; mso-ascii-font-family: Calibri; mso-hansi-font-family: Calibri; mso-themecolor: text1'><FONT face=Calibri>3)</FONT></SPAN><SPAN style='FONT-SIZE: 7pt; COLOR: black; FONT-FAMILY: ' Roman?,?serif?; mso-fareast-font-family: Calibri; mso-themecolor: text1? Times New>      </SPAN><FONT face=Calibri><SPAN style='FONT-SIZE: 12pt; COLOR: black; mso-fareast-font-family: ' Calibri; mso-themecolor: text1? Times New mso-bidi-font-family: ?Times mso-ascii-font-family: mso-hansi-font-family: Roman?;>If that fails then we need to escalate to Microsoft.</SPAN><SPAN style='FONT-SIZE: 12pt; COLOR: black; FONT-FAMILY: ' Roman?,?serif?; mso-fareast-font-family: mso-themecolor: text1? Times New ?Times Roman?;><o:p></o:p></SPAN></FONT> </p>
 
 <P class=MsoNormal style='MARGIN: 0in 0in 0pt 0.5in; TEXT-INDENT: -0.25in; LINE-HEIGHT: normal'><SPAN style='FONT-SIZE: 12pt; COLOR: black; mso-fareast-font-family: ' Calibri; mso-themecolor: text1? Times New mso-bidi-font-family: ?Times mso-ascii-font-family: mso-hansi-font-family: Roman?;><FONT face=Calibri>4)   If that fails then we need to hire a data recovery consultant<o:p></o:p></FONT></SPAN> </p>
 
 <P class=MsoNormal style='MARGIN: 0in 0in 0pt'></o:p></SPAN>  </p>

</td>
</tr>
<tr>
<td class="sectionLabel">
Details:
</td>
<td class="sectionContent">

</td>
</tr>
<tr>
<td class="sectionLabel">
Symptoms:
</td>
<td class="sectionContent">

</td>
</tr>
</table>
<br />
<hr />
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td>
<b>ID:</b> 040827721403860</td>
<td style="text-align: right;">
<b>Last Modified:</b> 12/29/2009 07:43:37 PM</td>
</tr>
</table>

    
    <!-- End Solution -->
	<br />
	<hr style="height: 5px" />
	<div class="subtext"><img src="images/CC3_logo.png" hspace=3 px/>Copyright &#0169 2008-2010 by the EncounterPRO Open Source Project. You may distribute it and/or modify it under the terms of the Creative Commons Attribution License, version 3.0 or later. All trademarks within this guide belong to their legitimate owners. Please attribute the EncounterPRO Open Source Project as the creator of this work. Please include this URL for the Work: encounterpro.org <br /> <a href=http://www.librarycopyright.net/wiki/index.php?title="How_to_attribute_a_Creative_Commons_licensed_work" target="_blank">Additional Instruction</a></div> 
       
		
</body>
</html>